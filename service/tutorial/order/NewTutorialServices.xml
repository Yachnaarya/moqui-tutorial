<?xml version="1.0" encoding="UTF-8"?>
<services xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/service-definition-2.1.xsd">
    
    <!--    Assignment 2-->

    <!--    Created Order-->
    <service verb="create" noun="OrderData" displayName="Create an order" type="inline">
        <in-parameters>
            <parameter name="orderName" required="true"/>
            <parameter name="currencyUomId" default-value="USD"/>
            <parameter name="salesChannelEnumId"/>
            <parameter name="statusId" default-value="orderPlaced"/>
            <parameter name="productStoreId"/>
            <parameter name="placedDate" required="true"/>
            <parameter name="approvedDate"/>
        </in-parameters>
        <out-parameters>
            <parameter name="orderId"/>
        </out-parameters>
        <actions>
            <entity-find entity-name="mantle.party.Party">
                <econdition field-name="partyId" value="CustJqp"/>
            </entity-find>
            <service-call name="create#mantle.order.OrderHeader" in-map="context" out-map="context"/>
        </actions>
    </service>

    <!--    Added Order Items-->

    <service verb="add" noun="orderAdd" displayName="Added an order" type="inline">
        <in-parameters>
            <parameter name="orderId" required="true"/>
            <parameter name="partName"/>
            <parameter name="facilityId" required="true"/>
            <parameter name="shipmentMethodEnumId" default-value="ShMthGround"/>
            <parameter name="customerPartyId"/>
            <parameter name="item_details" type="List">
                <parameter name="orderList" type="Map">
                    <parameter name="productId" required="true"/>
                    <parameter name="itemDescription" required="true"/>
                    <parameter name="quantity" required="true"/>
                    <parameter name="unitAmount" required="true"/>
                </parameter>
            </parameter>
        </in-parameters>
        <out-parameters>
            <parameter name="orderId"/>
            <parameter name="orderPartSeqId"/>
        </out-parameters>
        <actions>
            <set field="orders" from="[]"/>
            <iterate list="orderList" entry="orderHeader">
                <set field="orderId" from="orderHeader.orderId"/>
                <set field="currencyUomId" from="orderHeader.currencyUomId"/>
                <service-call name="create#mantle.order.OrderHeader" in-map="context" out-map="context"/>
                <if condition="orderId">
                    <set field="facilityId" from="orderPart.facilityId"/>
                    <set field="customerPartyId" from="orderPart.customerPartyId"/>
                    <set field="shipmentMethodEnumId" from="orderPart.shipmentMethodEnumId"/>
                    <set field="orderMap"
                         from="[orderId:orderPart.orderId,facilityId:OrderPart.facilityId,customerPartyId:OrderPart.customerPartyId,shipmentMethodEnumId:OrderPart.shipmentMethodEnumId,currencyUomId:OrderPart.currencyUomId]"/>
                    <set field="order" from="order+orderMap"/>
                    <service-call name="mantle.order.OrderPart.create#OrderPart" in-map="context+[orderId:orderId]"/>
                </if>
                <if condition="orderId">
                    <set field="itemDescription" from="orderItem.itemDescription"/>
                    <set field="productId" from="orderItem.productId"/>
                    <set field="quantity" from="orderItem.quantity"/>
                    <set field="unitAmount" from="orderItem.unitAmount"/>
                    <set field="orderMap"
                         from="[orderId:orderItem.orderId,currencyUomId:orderItem.currencyUomId,
                         itemDescription:orderItem.itemDescription,productId:orderItem.productId,quantity:orderItem.quantity,
                         unitAmount:orderItem.unitAmount]"/>
                    <set field="order" from="order+orderMap"/>
                    <service-call name="mantle.order.OrderPart.create#OrderItem" in-map="context+[orderId:orderId]"/>
                </if>
            </iterate>
        </actions>
    </service>

    <!--Get all Orders-->

    <service verb="get" noun="OrderList">
        <out-parameters>
            <parameter name="orders" type="list">
                <parameter name="orderId"/>
                <parameter name="orderName"/>
                <parameter name="currencyUomId"/>
                <parameter name="salesChannelEnumId"/>
                <parameter name="statusId"/>
                <parameter name="placedDate"/>
                <parameter name="grandTotal"/>
                <parameter name="customer_details" type="map">
                    <parameter name="firstName"/>
                    <parameter name="middleName"/>
                    <parameter name="lastName"/>
                </parameter>
                <parameter name="order_parts" type="list">
                    <parameter name="orderPartSeqId"/>
                    <parameter name="partName"/>
                    <parameter name="facilityId"/>
                    <parameter name="shipmentMethodEnumId"/>
                    <parameter name="partStatusId"/>
                    <parameter name="partTotal"/>
                    <parameter name="item_details" type="list">
                        <parameter name="orderItemSeqId"/>
                        <parameter name="productId"/>
                        <parameter name="itemDescription"/>
                        <parameter name="quantity"/>
                        <parameter name="unitAmount"/>
                    </parameter>
                </parameter>
            </parameter>
        </out-parameters>
        <actions>
            <set field="orders" from="[]"/>
            <entity-find entity-name="mantle.order.OrderHeader" list="orderList">
                <select-field field-name="orderId"/>
                <select-field field-name="orderName"/>
                <select-field field-name="currencyUomId"/>
                <select-field field-name="salesChannelEnumId"/>
                <select-field field-name="statusId"/>
                <select-field field-name="placedDate"/>
                <select-field field-name="grandTotal"/>
            </entity-find>
            <set field="customer_details" from="[]"/>
            <entity-find entity-name="mantle.party.Person" list="personList">
                <select-field field-name="firstName"/>
                <select-field field-name="middleName"/>
                <select-field field-name="lastName"/>
            </entity-find>
            <set field="order_parts" from="[]"/>
            <entity-find entity-name="mantle.order.OrderPart" list="orderPartList">
                <select-field field-name="orderPartSeqId"/>
                <select-field field-name="partName"/>
                <select-field field-name="facilityId"/>
                <select-field field-name="shipmentMethodEnumId"/>
                <select-field field-name="statusId"/>
                <select-field field-name="partTotal"/>
            </entity-find>
            <set field="item_details" from="[]"/>
            <entity-find entity-name="mantle.order.OrderItem" list="itemList">
                <select-field field-name="orderItemSeqId"/>
                <select-field field-name="productId"/>
                <select-field field-name="itemDescription"/>
                <select-field field-name="quantity"/>
                <select-field field-name="unitAmount"/>
            </entity-find>
            <iterate list="orderList" entry="orderHeader">
                <set field="orderId" from="orderHeader.orderId"/>
                <set field="orderName" from="orderHeader.orderName"/>
                <set field="currencyUomId" from="orderHeader.currencyUomId"/>
                <set field="placedDate" from="orderHeader.placedDate"/>
                <set field="grandTotal" from="orderHeader.grandTotal"/>
                <iterate list="personList" entry="person">
                    <set field="firstName" from="person.firstName"/>
                    <set field="middleName" from="person.middleName"/>
                    <set field="lastName" from="person.lastName"/>
                    <iterate list="orderPartList" entry="orderPart">
                        <set field="orderPartSeqId" from="orderPart.orderPartSeqId"/>
                        <set field="partName" from="orderPart.partName"/>
                        <set field="facilityId" from="orderPart.facilityId"/>
                        <set field="shipmentMethodEnumId" from="orderPart.shipmentMethodEnumId"/>
                        <set field="statusId" from="orderPart.statusId"/>
                        <set field="partTotal" from="orderPart.partTotal"/>
                        <iterate list="itemList" entry="orderItems">
                            <set field="orderItemSeqId" from="orderItems.orderItemSeqId"/>
                            <set field="productId" from="orderItems.productId"/>
                            <set field="itemDescription" from="orderItems.itemDescription"/>
                            <set field="quantity" from="orderItems.quantity"/>
                            <set field="unitAmount" from="orderItems.unitAmount"/>
                        </iterate>
                    </iterate>
                </iterate>
                <set field="orders"
                     from="orders+[orderId:orderId,orderName:orderName,currencyUomId:currencyUomId,salesChannelEnumId:salesChannelEnumId,
                     statusId:statusId,placedDate:placedDate,grandTotal:grandTotal]
                     +customer_details+[firstName:firstName,middleName:middleName,lastName:lastName]
                     +order_parts+[orderPartSeqId:orderPartSeqId,partName:partName,facilityId:facilityId,
                     shipmentMethodEnumId:shipmentMethodEnumId,statusId:statusId,partTotal:partTotal]
                     +item_details+[orderItemSeqId:orderItemSeqId,productId:productId,itemDescription:itemDescription,quantity:quantity,unitAmount:unitAmount]"/>
            </iterate>
        </actions>
    </service>

    <!--    Get an Order-->

    <service verb="get" noun="orderOne" type="inline">
        <in-parameters>
            <parameter name="orderId"></parameter>
        </in-parameters>
        <out-parameters>
            <parameter name="orders" type="list">
                <parameter name="orderId"/>
                <parameter name="orderName"/>
                <parameter name="currencyUomId"/>
                <parameter name="salesChannelEnumId"/>
                <parameter name="statusId"/>
                <parameter name="placedDate"/>
                <parameter name="grandTotal"/>
                <parameter name="customer_details" type="map">
                    <parameter name="partyId"/>
                    <parameter name="firstName"/>
                    <parameter name="middleName"/>
                    <parameter name="lastName"/>
                </parameter>
                <parameter name="order_parts" type="list">
                    <parameter name="orderPartSeqId"/>
                    <parameter name="partName"/>
                    <parameter name="facilityId"/>
                    <parameter name="shipmentMethodEnumId"/>
                    <parameter name="partStatusId"/>
                    <parameter name="partTotal"/>
                    <parameter name="item_details" type="list">
                        <parameter name="orderItemSeqId"/>
                        <parameter name="productId"/>
                        <parameter name="itemDescription"/>
                        <parameter name="quantity"/>
                        <parameter name="unitAmount"/>
                    </parameter>
                </parameter>
            </parameter>
        </out-parameters>
        <actions>
            <set field="orders" from="[]"/>
            <entity-find entity-name="mantle.order.OrderHeader" list="orderList">
                <select-field field-name="orderId"/>
                <select-field field-name="orderName"/>
                <select-field field-name="currencyUomId"/>
                <select-field field-name="salesChannelEnumId"/>
                <select-field field-name="statusId"/>
                <select-field field-name="placedDate"/>
                <select-field field-name="grandTotal"/>
            </entity-find>
            <set field="customer_details" from="[]"/>
            <entity-find entity-name="mantle.party.Person" list="personList">
                <select-field field-name="firstName"/>
                <select-field field-name="middleName"/>
                <select-field field-name="lastName"/>
            </entity-find>
            <set field="order_parts" from="[]"/>
            <entity-find entity-name="mantle.order.OrderPart" list="orderPartList">
                <select-field field-name="orderPartSeqId"/>
                <select-field field-name="partName"/>
                <select-field field-name="facilityId"/>
                <select-field field-name="shipmentMethodEnumId"/>
                <select-field field-name="statusId"/>
                <select-field field-name="partTotal"/>
            </entity-find>
            <set field="item_details" from="[]"/>
            <entity-find entity-name="mantle.order.OrderItem" list="itemList">
                <select-field field-name="orderItemSeqId"/>
                <select-field field-name="productId"/>
                <select-field field-name="itemDescription"/>
                <select-field field-name="quantity"/>
                <select-field field-name="unitAmount"/>
            </entity-find>
            <iterate list="orderList" entry="orderHeader">
                <set field="orderId" from="orderHeader.orderId"/>
                <set field="orderName" from="orderHeader.orderName"/>
                <set field="currencyUomId" from="orderHeader.currencyUomId"/>
                <set field="placedDate" from="orderHeader.placedDate"/>
                <set field="grandTotal" from="orderHeader.grandTotal"/>
                <iterate list="personList" entry="person">
                    <set field="firstName" from="person.firstName"/>
                    <set field="middleName" from="person.middleName"/>
                    <set field="lastName" from="person.lastName"/>
                </iterate>
                    <iterate list="orderPartList" entry="orderPart">
                        <set field="orderPartSeqId" from="orderPart.orderPartSeqId"/>
                        <set field="partName" from="orderPart.partName"/>
                        <set field="facilityId" from="orderPart.facilityId"/>
                        <set field="shipmentMethodEnumId" from="orderPart.shipmentMethodEnumId"/>
                        <set field="statusId" from="orderPart.statusId"/>
                        <set field="partTotal" from="orderPart.partTotal"/>
                    </iterate>
                        <iterate list="itemList" entry="orderItems">
                            <set field="orderItemSeqId" from="orderItems.orderItemSeqId"/>
                            <set field="productId" from="orderItems.productId"/>
                            <set field="itemDescription" from="orderItems.itemDescription"/>
                            <set field="quantity" from="orderItems.quantity"/>
                            <set field="unitAmount" from="orderItems.unitAmount"/>
                        </iterate>

                </iterate>
                <set field="orders"
                     from="orders+[orderId:orderId,orderName:orderName,currencyUomId:currencyUomId,salesChannelEnumId:salesChannelEnumId,
                     statusId:statusId,placedDate:placedDate,grandTotal:grandTotal]
                     +customer_details+[firstName:firstName,middleName:middleName,lastName:lastName]
                     +order_parts+[orderPartSeqId:orderPartSeqId,partName:partName,facilityId:facilityId,
                     shipmentMethodEnumId:shipmentMethodEnumId,statusId:statusId,partTotal:partTotal]
                     +item_details+[orderItemSeqId:orderItemSeqId,productId:productId,itemDescription:itemDescription,quantity:quantity,unitAmount:unitAmount]"/>

        </actions>
    </service>

    <!--    Update Order-->

    <service verb="update" noun="orderUpdate" type="inline">
        <in-parameters>
            <parameter name="orderId"/>
            <parameter name="orderName"/>
        </in-parameters>
        <out-parameters>
            <parameter name="orderId"/>
            <parameter name="orderName"/>
            <parameter name="placedDate"/>
            <parameter name="approvedDate"/>
            <parameter name="statusId"/>
            <parameter name="currencyUomId"/>
            <parameter name="productStoreId"/>
            <parameter name="salesChannelEnumId"/>
            <parameter name="grandTotal"/>
        </out-parameters>
        <actions>
            <service-call name="update#mantle.order.OrderHeader"
                          in-map="context"
                          out-map="context"/>
        </actions>
    </service>
</services>